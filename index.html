{\rtf1\ansi\ansicpg932\cocoartf2822
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 Menlo-Regular;}
{\colortbl;\red255\green255\blue255;\red70\green137\blue204;\red23\green24\blue24;}
{\*\expandedcolortbl;;\cssrgb\c33725\c61176\c83922;\cssrgb\c11765\c12157\c12549;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab720
\pard\pardeftab720\partightenfactor0

\f0\fs28 \cf2 \cb3 \expnd0\expndtw0\kerning0
\outl0\strokewidth0 \strokec2 <!DOCTYPE html>\
<html lang="ja">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>\uc0\u12480 \u12452 \u12450 \u12488 \u12491 \u12483 \u12463 \u12467 \u12540 \u12489 \u12539 \u12463 \u12452 \u12474 </title>\
    <script src="https://cdn.tailwindcss.com"></script>\
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">\
    <style>\
        body \{\
            font-family: 'Inter', 'Noto Sans JP', sans-serif;\
            -webkit-font-smoothing: antialiased;\
            -moz-osx-font-smoothing: grayscale;\
        \}\
        .result-table th, .result-table td \{\
            padding: 8px 12px;\
            text-align: left;\
            border-bottom: 1px solid #e2e8f0;\
        \}\
    </style>\
</head>\
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">\
\
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-lg p-6 md:p-8">\
        <div class="text-center mb-6">\
            <h1 class="text-3xl font-bold text-gray-900">\uc0\u12480 \u12452 \u12450 \u12488 \u12491 \u12483 \u12463 \u12467 \u12540 \u12489 \u12539 \u12463 \u12452 \u12474 </h1>\
            <p class="text-gray-500 mt-2">\uc0\u25351 \u23450 \u12373 \u12428 \u12383 \u12461 \u12540 \u12398 \u12480 \u12452 \u12450 \u12488 \u12491 \u12483 \u12463 \u12467 \u12540 \u12489 \u12434 \u31572 \u12360 \u12424 \u12358 \u65281 </p>\
        </div>\
\
        <!-- Settings -->\
        <div class="mb-6 p-4 bg-gray-50 rounded-lg">\
            <div class="mb-4">\
                <label for="user-name" class="block text-sm font-medium text-gray-700 mb-1">\uc0\u22238 \u31572 \u32773 \u21517 </label>\
                <input type="text" id="user-name" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="\uc0\u21517 \u21069 \u12434 \u20837 \u21147 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 ">\
            </div>\
            <div class="flex flex-col sm:flex-row gap-4">\
                <div class="flex-1">\
                    <label for="key-select" class="block text-sm font-medium text-gray-700 mb-1">\uc0\u12461 \u12540 </label>\
                    <select id="key-select" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">\
                        <option value="C">C</option>\
                        <option value="G">G</option>\
                        <option value="D">D</option>\
                        <option value="A">A</option>\
                        <option value="E">E</option>\
                        <option value="B">B</option>\
                        <option value="F#">F# / Gb</option>\
                        <option value="C#">C# / Db</option>\
                        <option value="F">F</option>\
                        <option value="Bb">Bb</option>\
                        <option value="Eb">Eb</option>\
                        <option value="Ab">Ab</option>\
                    </select>\
                </div>\
                <div class="flex-1">\
                    <label for="scale-select" class="block text-sm font-medium text-gray-700 mb-1">\uc0\u12473 \u12465 \u12540 \u12523 </label>\
                    <select id="scale-select" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">\
                        <option value="major">\uc0\u12513 \u12472 \u12515 \u12540 </option>\
                        <option value="minor">\uc0\u12510 \u12452 \u12490 \u12540  (\u12490 \u12481 \u12517 \u12521 \u12523 )</option>\
                    </select>\
                </div>\
                <div class="flex-1">\
                    <label for="chord-type-select" class="block text-sm font-medium text-gray-700 mb-1">\uc0\u21644 \u38899 \u12398 \u31278 \u39006 </label>\
                    <select id="chord-type-select" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">\
                        <option value="triad">\uc0\u19977 \u21644 \u38899  (\u12488 \u12521 \u12452 \u12450 \u12489 )</option>\
                        <option value="seventh">\uc0\u22235 \u21644 \u38899  (\u12475 \u12502 \u12531 \u12473 )</option>\
                    </select>\
                </div>\
                <button id="start-quiz-btn" class="self-end sm:self-center h-10 px-6 bg-indigo-600 text-white font-semibold rounded-md shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors">\
                    \uc0\u26032 \u12375 \u12356 \u21839 \u38988 \
                </button>\
            </div>\
        </div>\
\
        <!-- Quiz Area -->\
        <div id="quiz-container" class="mb-4">\
            <h2 id="quiz-title" class="text-xl font-semibold mb-4 text-center"></h2>\
            <div id="answers-grid" class="grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-3">\
                <!-- Answer inputs will be generated here -->\
            </div>\
        </div>\
\
        <!-- Action Buttons and Feedback -->\
        <div class="text-center mb-6">\
            <button id="submit-btn" class="px-8 py-3 bg-green-500 text-white font-bold rounded-lg shadow-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105">\
                \uc0\u31572 \u12360 \u21512 \u12431 \u12379 \
            </button>\
            <div id="feedback" class="mt-4 text-lg font-medium h-6"></div>\
        </div>\
        \
        <!-- Results Area -->\
        <div class="border-t pt-6">\
            <div class="text-center">\
                <button id="toggle-results-btn" class="w-full sm:w-auto px-6 py-2 bg-gray-200 text-gray-700 font-semibold rounded-md hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">\
                    \uc0\u32080 \u26524 \u12434 \u35211 \u12427 \
                </button>\
            </div>\
            <div id="results-container" class="hidden mt-4 max-h-60 overflow-y-auto">\
                 <table class="w-full text-sm result-table">\
                    <thead>\
                        <tr>\
                            <th>\uc0\u26085 \u26178 </th>\
                            <th>\uc0\u22238 \u31572 \u32773 </th>\
                            <th>\uc0\u21839 \u38988 </th>\
                            <th>\uc0\u12354 \u12394 \u12383 \u12398 \u22238 \u31572 </th>\
                        </tr>\
                    </thead>\
                    <tbody id="results-body">\
                        <!-- Results will be populated here -->\
                    </tbody>\
                </table>\
            </div>\
        </div>\
    </div>\
\
    <!-- Firebase SDKs -->\
    <script type="module">\
        // Import the functions you need from the SDKs you need\
        import \{ initializeApp \} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";\
        import \{ getFirestore, collection, addDoc, query, getDocs, orderBy, limit \} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";\
\
        // Your web app's Firebase configuration\
        // \uc0\u9660 \u9660 \u9660  \u12371 \u12371 \u12395 Firebase\u12398 \u35373 \u23450 \u12434 \u36028 \u12426 \u20184 \u12369  \u9660 \u9660 \u9660 \
const firebaseConfig = \{\
  apiKey: "AIzaSyCOIicc6JflKhz_o9irJ_qJRTI7Wr2IELk",\
  authDomain: "diatonic-quiz-app.firebaseapp.com",\
  projectId: "diatonic-quiz-app",\
  storageBucket: "diatonic-quiz-app.firebasestorage.app",\
  messagingSenderId: "1045630189799",\
  appId: "1:1045630189799:web:083f74322758f451f9a242"\
\};\
        // \uc0\u9650 \u9650 \u9650  \u12371 \u12371 \u12414 \u12391  \u9650 \u9650 \u9650 \
\
        // Initialize Firebase\
        const app = initializeApp(firebaseConfig);\
        const db = getFirestore(app);\
\
\
        // --- Music Theory Logic ---\
        const NOTES_SHARP = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B'];\
        const NOTES_FLAT = ['C', 'Db', 'D', 'Eb', 'E', 'F', 'Gb', 'G', 'Ab', 'A', 'Bb', 'B'];\
\
        const SCALE_INTERVALS = \{\
            major: [0, 2, 4, 5, 7, 9, 11],\
            minor: [0, 2, 3, 5, 7, 8, 10]\
        \};\
\
        const CHORD_QUALITIES = \{\
            major: \{\
                triad: ['', 'm', 'm', '', '', 'm', 'mb5'],\
                seventh: ['Maj7', 'm7', 'm7', 'Maj7', '7', 'm7', 'm7b5']\
            \},\
            minor: \{\
                triad: ['m', 'mb5', '', 'm', 'm', '', ''],\
                seventh: ['m7', 'm7b5', 'Maj7', 'm7', 'm7', 'Maj7', '7']\
            \}\
        \};\
        \
        const SHARP_KEYS = ['C', 'G', 'D', 'A', 'E', 'B', 'F#', 'C#'];\
\
        // --- State Management ---\
        let currentCorrectAnswers = [];\
        let currentQuizInfo = \{ key: '', scale: '', chordType: '' \};\
\
        // --- DOM Elements ---\
        const userNameInput = document.getElementById('user-name');\
        const keySelect = document.getElementById('key-select');\
        const scaleSelect = document.getElementById('scale-select');\
        const chordTypeSelect = document.getElementById('chord-type-select');\
        const startQuizBtn = document.getElementById('start-quiz-btn');\
        const quizTitle = document.getElementById('quiz-title');\
        const answersGrid = document.getElementById('answers-grid');\
        const submitBtn = document.getElementById('submit-btn');\
        const feedback = document.getElementById('feedback');\
        const toggleResultsBtn = document.getElementById('toggle-results-btn');\
        const resultsContainer = document.getElementById('results-container');\
        const resultsBody = document.getElementById('results-body');\
\
        function generateDiatonicChords(rootNote, scaleType, chordType) \{\
            const useSharp = SHARP_KEYS.includes(rootNote) || (rootNote.includes('#') && !rootNote.includes('b'));\
            const noteSet = useSharp ? NOTES_SHARP : NOTES_FLAT;\
            const rootIndex = noteSet.indexOf(rootNote.split(' ')[0]);\
            if (rootIndex === -1) \{\
                 const altRootIndex = NOTES_FLAT.indexOf(rootNote);\
                 if (altRootIndex !== -1) \{\
                    return generateDiatonicChords(rootNote, scaleType, chordType);\
                 \}\
                 console.error("Invalid root note:", rootNote);\
                 return [];\
            \}\
            const scaleIntervals = SCALE_INTERVALS[scaleType];\
            const chordQualities = CHORD_QUALITIES[scaleType][chordType];\
            return scaleIntervals.map((interval, i) => \{\
                const noteIndex = (rootIndex + interval) % 12;\
                return `$\{noteSet[noteIndex]\}$\{chordQualities[i]\}`;\
            \});\
        \}\
\
        function normalizeAnswer(input) \{\
            if (!input || input.length === 0) return "";\
            let text = input.trim();\
            text = text.replace(/\uc0\u9651 7|\u916 7/g, 'Maj7');\
            text = text.replace(/\'f87|\'f8/g, 'm7b5');\
            text = text.replace(/\'b0/g, 'mb5');\
            text = text.replace(/dim$/ig, 'mb5');\
            text = text.replace(/(m-5|mb5)$/ig, 'mb5');\
            text = text.replace(/-7/g, 'm7');\
            text = text.replace(/ma7/ig, 'Maj7');\
            text = text.replace(/M7/g, 'Maj7');\
            text = text.replace(/m7b5/i, 'm7b5');\
            if (text.endsWith('-') && text.length > 1) text = text.slice(0, -1) + 'm';\
            if (text.endsWith('o') && text.length > 1) text = text.slice(0, -1) + 'dim';\
            const rootMatch = text.match(/^[A-G][#b]?/i);\
            if (!rootMatch) return text;\
            let root = rootMatch[0];\
            let quality = text.substring(root.length);\
            root = root.charAt(0).toUpperCase() + root.slice(1).toLowerCase();\
            if (quality.toLowerCase() === 'maj7') quality = 'Maj7';\
            if (quality.toLowerCase() === 'm' && text.endsWith('m')) quality = 'm';\
            return root + quality;\
        \}\
        \
        function getEnharmonicEquivalents(chord) \{\
             const equivalents = \{'C#':'Db','Db':'C#','D#':'Eb','Eb':'D#','F#':'Gb','Gb':'F#','G#':'Ab','Ab':'G#','A#':'Bb','Bb':'A#'\};\
            const match = chord.match(/^[A-G][#b]?/);\
            if (!match) return [chord];\
            const root = match[0];\
            const quality = chord.substring(root.length);\
            const enharmonicRoot = equivalents[root];\
            return enharmonicRoot ? [chord, enharmonicRoot + quality] : [chord];\
        \}\
\
        function startNewQuiz() \{\
            const selectedKey = keySelect.value;\
            const selectedScale = scaleSelect.value;\
            const selectedChordType = chordTypeSelect.value;\
            currentQuizInfo = \{ \
                key: selectedKey, \
                scale: selectedScale,\
                chordType: selectedChordType,\
                scaleText: scaleSelect.options[scaleSelect.selectedIndex].text,\
                chordTypeText: chordTypeSelect.options[chordTypeSelect.selectedIndex].text\
            \};\
            quizTitle.textContent = `$\{selectedKey\} $\{currentQuizInfo.scaleText\}\uc0\u12473 \u12465 \u12540 \u12523  ($\{currentQuizInfo.chordTypeText\})`;\
            currentCorrectAnswers = generateDiatonicChords(selectedKey, selectedScale, selectedChordType);\
            answersGrid.innerHTML = '';\
            const romanNumerals = ['I', 'II', 'III', 'IV', 'V', 'VI', 'VII'];\
            for (let i = 0; i < 7; i++) \{\
                const wrapper = document.createElement('div');\
                const label = document.createElement('label');\
                label.className = "block text-sm font-medium text-center text-gray-500 mb-1";\
                label.textContent = romanNumerals[i];\
                const input = document.createElement('input');\
                input.type = 'text';\
                input.className = 'answer-input w-full p-2 text-center border-gray-300 border rounded-md focus:ring-indigo-500 focus:border-indigo-500 transition-colors';\
                input.setAttribute('aria-label', `Chord $\{i + 1\}`);\
                wrapper.appendChild(label);\
                wrapper.appendChild(input);\
                answersGrid.appendChild(wrapper);\
            \}\
            feedback.textContent = '';\
            feedback.className = 'mt-4 text-lg font-medium h-6';\
        \}\
\
        async function checkAnswers() \{\
            const inputs = document.querySelectorAll('.answer-input');\
            const userAnswers = Array.from(inputs).map(input => normalizeAnswer(input.value));\
            let allCorrect = true;\
            userAnswers.forEach((answer, i) => \{\
                const correctChord = currentCorrectAnswers[i];\
                const possibleAnswers = getEnharmonicEquivalents(correctChord);\
                if (possibleAnswers.includes(answer)) \{\
                    inputs[i].classList.remove('border-red-500');\
                    inputs[i].classList.add('border-green-500');\
                \} else \{\
                    inputs[i].classList.remove('border-green-500');\
                    inputs[i].classList.add('border-red-500');\
                    allCorrect = false;\
                \}\
            \});\
            if (allCorrect) \{\
                feedback.textContent = '\uc0\u32032 \u26228 \u12425 \u12375 \u12356 \u12289 \u27491 \u35299 \u12391 \u12377 \u65281 ';\
                feedback.className = 'mt-4 text-lg font-medium h-6 text-green-600';\
                await saveResult(userAnswers.join(', '));\
            \} else \{\
                feedback.textContent = '\uc0\u24796 \u12375 \u12356 \u65281 \u36196 \u12356 \u26528 \u12398 \u12467 \u12540 \u12489 \u12364 \u36949 \u12356 \u12414 \u12377 \u12290 ';\
                feedback.className = 'mt-4 text-lg font-medium h-6 text-red-600';\
            \}\
        \}\
\
        async function saveResult(answers) \{\
            const userName = userNameInput.value.trim() || '\uc0\u21311 \u21517 ';\
            const newResult = \{\
                date: new Date(), // Firestore handles timestamp conversion\
                user: userName,\
                quiz: `$\{currentQuizInfo.key\} $\{currentQuizInfo.scaleText\} ($\{currentQuizInfo.chordTypeText\})`,\
                answers: answers\
            \};\
            try \{\
                await addDoc(collection(db, "quizResults"), newResult);\
            \} catch (e) \{\
                console.error("Error adding document: ", e);\
                alert("\uc0\u32080 \u26524 \u12398 \u20445 \u23384 \u12395 \u22833 \u25943 \u12375 \u12414 \u12375 \u12383 \u12290 ");\
            \}\
        \}\
\
        async function loadResults() \{\
            resultsBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 py-4">\uc0\u35501 \u12415 \u36796 \u12415 \u20013 ...</td></tr>';\
            try \{\
                const q = query(collection(db, "quizResults"), orderBy("date", "desc"), limit(50));\
                const querySnapshot = await getDocs(q);\
                const results = [];\
                querySnapshot.forEach((doc) => \{\
                    results.push(doc.data());\
                \});\
\
                resultsBody.innerHTML = '';\
                if (results.length === 0) \{\
                    resultsBody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-500 py-4">\uc0\u12414 \u12384 \u35352 \u37682 \u12364 \u12354 \u12426 \u12414 \u12379 \u12435 \u12290 </td></tr>';\
                    return;\
                \}\
                results.forEach(result => \{\
                    const row = document.createElement('tr');\
                    row.innerHTML = `\
                        <td class="whitespace-nowrap">$\{result.date.toDate().toLocaleString('ja-JP')\}</td>\
                        <td>$\{result.user\}</td>\
                        <td>$\{result.quiz\}</td>\
                        <td>$\{result.answers\}</td>\
                    `;\
                    resultsBody.appendChild(row);\
                \});\
            \} catch (e) \{\
                console.error("Error loading results:", e);\
                resultsBody.innerHTML = '<tr><td colspan="4" class="text-center text-red-500 py-4">\uc0\u32080 \u26524 \u12398 \u35501 \u12415 \u36796 \u12415 \u12395 \u22833 \u25943 \u12375 \u12414 \u12375 \u12383 \u12290 Firebase\u12398 \u35373 \u23450 \u12434 \u30906 \u35469 \u12375 \u12390 \u12367 \u12384 \u12373 \u12356 \u12290 </td></tr>';\
            \}\
        \}\
        \
        async function toggleResults() \{\
            const isHidden = resultsContainer.classList.contains('hidden');\
            if (isHidden) \{\
                await loadResults();\
                resultsContainer.classList.remove('hidden');\
                toggleResultsBtn.textContent = '\uc0\u32080 \u26524 \u12434 \u38560 \u12377 ';\
            \} else \{\
                resultsContainer.classList.add('hidden');\
                toggleResultsBtn.textContent = '\uc0\u32080 \u26524 \u12434 \u35211 \u12427 ';\
            \}\
        \}\
\
        // --- Event Listeners ---\
        startQuizBtn.addEventListener('click', startNewQuiz);\
        submitBtn.addEventListener('click', checkAnswers);\
        toggleResultsBtn.addEventListener('click', toggleResults);\
\
        // --- Initial Load ---\
        document.addEventListener('DOMContentLoaded', () => \{\
            startNewQuiz();\
        \});\
\
    </script>\
</body>\
</html>\
\
}